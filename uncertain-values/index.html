<!DOCTYPE html>
 <html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title data-react-helmet="true">Programming with Uncertain Values | Left Fold</title><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75em Merriweather,Georgia,serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:Merriweather,Georgia,serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:3.5rem;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Merriweather,Georgia,serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:2.625rem;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Merriweather,Georgia,serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.75rem;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Merriweather,Georgia,serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.75rem;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Merriweather,Georgia,serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.75rem;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Merriweather,Georgia,serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.75rem;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:tnum;-moz-font-feature-settings:tnum;-ms-font-feature-settings:tnum;-webkit-font-feature-settings:tnum;padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}</style><link href="//fonts.googleapis.com/css?family=Montserrat:700|Merriweather:400,400i,700,700i,900,900i" rel="stylesheet" type="text/css"/><style>.markdown pre{display:block;background:#3f3f3f;color:#dcdcdc;overflow-y:hidden}.markdown pre code{background:none;border:none;border-radius:3px;display:inline-block;overflow:inherit;padding:1.58333rem;white-space:inherit;word-wrap:normal}code{border-radius:3px;white-space:pre;white-space:pre-wrap;white-space:pre-line;white-space:-pre-wrap;white-space:-o-pre-wrap;white-space:-moz-pre-wrap;white-space:-hp-pre-wrap;word-wrap:break-word;background:#e5e5e5;border:1px solid #ccc;display:inline;font-family:Inconsolata,monospace,serif;max-width:100%;overflow:auto;padding:0 .1625rem}.clojure .hljs-attribute,.css .hljs-class,.css .hljs-id,.hljs-keyword,.hljs-request,.hljs-status,.hljs-tag,.lisp .hljs-title,.nginx .hljs-title{color:#e3ceab}.django .hljs-filter .hljs-argument,.django .hljs-template_tag,.django .hljs-variable{color:#dcdcdc}.hljs-date,.hljs-number{color:#8cd0d3}.apache .hljs-sqbracket,.dos .hljs-envvar,.dos .hljs-stream,.hljs-variable{color:#efdcbc}.diff .hljs-change,.dos .hljs-flow,.hljs-literal,.python .exception,.python .hljs-built_in,.tex .hljs-special{color:#efefaf}.diff .hljs-chunk,.hljs-subst{color:#8f8f8f}.apache .hljs-tag,.diff .hljs-header,.dos .hljs-keyword,.haskell .hljs-type,.hljs-prompt,.hljs-title,.nginx .hljs-built_in,.python .hljs-decorator,.ruby .hljs-class .hljs-parent,.tex .hljs-command{color:#efef8f}.dos .hljs-winutils,.ruby .hljs-string,.ruby .hljs-symbol,.ruby .hljs-symbol .hljs-string{color:#dca3a3}.apache .hljs-cbracket,.coffeescript .hljs-attribute,.css .hljs-rules .hljs-value,.diff .hljs-deletion,.hljs-attr_selector,.hljs-built_in,.hljs-javadoc,.hljs-pragma,.hljs-preprocessor,.hljs-pseudo,.hljs-string,.hljs-tag .hljs-value,.smalltalk .hljs-array,.smalltalk .hljs-class,.smalltalk .hljs-localvars,.sql .hljs-aggregate,.tex .hljs-formula{color:#cc9393}.diff .hljs-addition,.hljs-comment,.hljs-doctype,.hljs-pi,.hljs-shebang,.hljs-template_comment,.java .hljs-annotation{color:#7f9f7f}.coffeescript .javascript,.javascript .xml,.tex .hljs-formula,.xml .css,.xml .hljs-cdata,.xml .javascript,.xml .vbscript{opacity:.5}</style></head><body><div id="react-mount"><div style="max-width:42rem;margin-left:auto;margin-right:auto;padding:2.625rem 1.3125rem;" data-reactroot="" data-reactid="1" data-react-checksum="493519555"><h3 style="font-family:Montserrat, sans-serif;margin-top:0;" data-reactid="2"><a style="box-shadow:none;text-decoration:none;color:inherit;" href="/" data-reactid="3">Left Fold</a></h3><div class="markdown" data-reactid="4"><!-- react-empty: 5 --><h1 style="margin-top:0;" data-reactid="6">Programming with Uncertain Values</h1><div data-reactid="7"><p>A common pain in programming is when you need to do something with a value that might not exist. You have to wrap all the code that depends on that value inside an <code>if</code> statement checking for <code>null</code>.  It’s a little bit like using node.js-style callbacks; everything that needs the value has to be nested inside the callback:</p>
<pre><code><span class="hljs-keyword">const</span> getUserName = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> data = <span class="hljs-built_in">window</span>.localstorage.getItem(<span class="hljs-string">'user'</span>)
    <span class="hljs-keyword">if</span>(data){
        <span class="hljs-keyword">const</span> user = <span class="hljs-built_in">JSON</span>.parse(data)
        <span class="hljs-keyword">if</span>(user.hasOwnProperty(<span class="hljs-string">'name'</span>)){
            <span class="hljs-keyword">return</span> user.name
        }
    }
}
</code></pre>
<p>Pyramid of doom!</p>
<p>And the uncertainty propagates out to any code that calls <code>getUserName</code>, because it might not return a user name.</p>
<p>What we want is an abstraction that lets you do stuff with a value, whether it exists or not, without having to wrap everything in <code>if</code>s at each step.</p>
<h3>A context for certainty</h3>
<p>An abstraction that does this, is <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/map">Array.prototype.map</a>. You pass a function into <code>map</code> and it will do stuff to the contents of the array, whether they exist or not. <code>[].map(f)</code> doesn’t run <code>f</code> and is perfectly safe, no <code>if</code>s required.</p>
<p>So we can do:</p>
<pre><code><span class="hljs-keyword">const</span> localStorageGet = <span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> data = <span class="hljs-built_in">window</span>.localStorage.getItem(key)
    <span class="hljs-keyword">return</span> data? [data] : []
}
<span class="hljs-keyword">const</span> getUser = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> 
    localStorageGet(<span class="hljs-string">'user'</span>)
    .map(<span class="hljs-built_in">JSON</span>.parse)
</code></pre>
<p>Now whenever we want to do something with our (potential) user object, we can just map a function over the array containing it. If the array is empty, the functions don’t get run.
Any transformation we need to run can be isolated in discrete functions, and they don’t need to check for <code>null</code>/<code>undefined</code>. We only need to remember to deal with the possibility that we never had a user in the first place when we unpack the value from our containing <code>[]</code>:</p>
<pre><code><span class="hljs-keyword">const</span> userName = getUser().map(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> u.name)

<span class="hljs-comment">//now we unpack it, with a default if it doesn't exist.</span>
<span class="hljs-keyword">const</span> displayName = userName.length? userName[<span class="hljs-number">0</span>] : <span class="hljs-string">'Guest'</span> 
</code></pre>
<p>We’ve got something pretty nice with this <code>map</code> abstraction.  We can compose functions over our potential value without needing to null check in each function.</p>
<pre><code>f(<span class="hljs-name">g</span>(<span class="hljs-name">h</span>(<span class="hljs-name">undefined</span>)))
</code></pre>
<p>would blow up on us if  <code>h</code> <code>g</code> or <code>f</code> don’t expect their argument to be <code>undefined</code>, but</p>
<pre><code>[].map(<span class="hljs-name">h</span>).map(<span class="hljs-name">g</span>).map(<span class="hljs-name">f</span>)
</code></pre>
<p>won’t run <code>h</code> <code>g</code> or <code>f</code> because the array doesn’t have a value to run them over.</p>
<p>However, it <em>is</em> a bit hacky to overload Array in this way, because, for example:</p>
<ol>
<li>How do you tell if <code>[x]</code> is meant to be an array or a “potential value”?</li>
<li>If you want to represent a <em>potential</em> <code>false</code>, <code>null</code>, or <code>undefined</code>, you have to be careful how you check whether the value exists</li>
<li>If you <code>map</code> a function that returns a potential value, over a potential value, you get either <code>[]</code>, <code>[[]]</code> or <code>[[x]]</code>, which can be a little fiddly to map over or unpack.</li>
</ol>
<h3>Maybe: A datatype for values that might not exist</h3>
<p>What we <em>really</em> want is a datatype designed to represent values that might not exist. Many functional languages and libraries have this type, and it’s called <code>Maybe</code>. You can find good implementations of this in libraries like <a href="http://folktalejs.org/">folktale</a>, <a href="https://github.com/ramda/ramda-fantasy/">ramda-fantasy</a> or <a href="http://sanctuary.org/">sanctuary</a>, but we’ll define a simple version here to see how it works.</p>
<pre><code><span class="hljs-keyword">const</span> Just  = <span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> ({
    <span class="hljs-attr">map</span>: <span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> Just(f(x)),
    <span class="hljs-attr">chain</span>: <span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f(x),
    <span class="hljs-attr">getOrElse</span>: <span class="hljs-function"><span class="hljs-params">default</span> =&gt;</span> x
})
<span class="hljs-keyword">const</span> Nothing = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> ({
    <span class="hljs-attr">map</span>: <span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> Nothing(),
    <span class="hljs-attr">chain</span>: <span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> Nothing(),
    <span class="hljs-attr">getOrElse</span>: <span class="hljs-function"><span class="hljs-params">default</span> =&gt;</span> <span class="hljs-keyword">default</span>
})
</code></pre>
<p><code>Just</code> and <code>Nothing</code> are two types that share the same <code>Maybe</code> interface. A <code>Maybe</code> is something that could be a <code>Just</code> or a <code>Nothing</code>; we don’t need to care which we have, because they both have the same interface, and it will all just work.</p>
<p><code>Just(x)</code> is what we use instead of <code>[x]</code>. <code>Just(1).map(x =&gt;x+1)</code> works just the same as <code>[1].map(x=&gt;x+1)</code>. <code>Just(a).map(f)</code> is equal to <code>Just(f(a))</code></p>
<p><code>Nothing().map(x=&gt;x+1)</code> works the same as <code>[].map(x=&gt;x+1)</code> - ie, you just get another <code>Nothing</code> back.</p>
<p><code>getOrElse</code> will give us either a value (from a <code>Just</code>) or the provided default (if we’ve got a <code>Nothing</code>):</p>
<pre><code><span class="hljs-function"><span class="hljs-title">Just</span><span class="hljs-params">(<span class="hljs-number">3</span>)</span></span>.getOrElse(<span class="hljs-number">5</span>) <span class="hljs-comment">//=&gt; 3</span>
<span class="hljs-function"><span class="hljs-title">Nothing</span><span class="hljs-params">()</span></span>.getOrElse(<span class="hljs-number">5</span>) <span class="hljs-comment">//=&gt; 5</span>
</code></pre>
<p><code>chain</code> lets us compose in functions that themselves return <em>Maybe</em>s rather than ordinary values - we’ll see an example of this shortly.</p>
<h3>How we use Maybe in practice</h3>
<p>A common use for Maybes is when you want to access an object property that might not exist:</p>
<pre><code><span class="hljs-comment">//:: String -&gt; Object -&gt; Maybe value</span>
<span class="hljs-keyword">const</span> safeProp = <span class="hljs-keyword">prop</span> =&gt; 
    obj =&gt; 
    obj.hasOwnProperty(<span class="hljs-keyword">prop</span>)? Just(obj[<span class="hljs-keyword">prop</span>]) : Nothing()

</code></pre>
<p>An example:</p>
<pre><code>const data = { contact: { email: <span class="hljs-string">"abcd@example.org"</span> } }
<span class="hljs-function"><span class="hljs-title">safeProp</span><span class="hljs-params">(<span class="hljs-string">'contact'</span>)</span><span class="hljs-params">(data)</span></span> <span class="hljs-comment">//=&gt; Just({ email "abcd@example.org"})</span>
<span class="hljs-function"><span class="hljs-title">safeProp</span><span class="hljs-params">(<span class="hljs-string">'contact'</span>)</span><span class="hljs-params">({})</span></span> <span class="hljs-comment">//=&gt; Nothing()</span>
</code></pre>
<p>But what if we want to safely access <code>data.contact.email</code>?</p>
<pre><code><span class="hljs-function"><span class="hljs-title">safeProp</span><span class="hljs-params">(<span class="hljs-string">'contact'</span>)</span><span class="hljs-params">(data)</span></span>.map(safeProp(<span class="hljs-string">'email'</span>))
</code></pre>
<p>would give us <code>Just(Just(&quot;abcd@example.org&quot;))</code> which would be fiddly to map over or unpack.</p>
<p>This is why we’ve got <code>chain</code>:</p>
<pre><code><span class="hljs-function"><span class="hljs-title">safeProp</span><span class="hljs-params">(<span class="hljs-string">'contact'</span>)</span><span class="hljs-params">(data)</span></span>
    .chain(safeProp(<span class="hljs-string">'email'</span>))
</code></pre>
<p>gives us simply <code>Just(&quot;abcd@example.org&quot;)</code></p>
<p>If you’re familiar with Promises, you might be seeing a parallel here: <em>Promise</em> lets you do something with a value <em>when</em> it exists; <em>Maybe</em> lets you do something with a value <em>if</em> it exists.</p>
<p>Promises let you flatten out nested callbacks (also known as “callback hell”), Maybes let you flatten out nested <code>if</code>s (“uncertainty hell”?):</p>
<pre><code><span class="hljs-keyword">const</span> getUserName = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">default</span>=<span class="hljs-string">'Guest'</span></span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> data = <span class="hljs-built_in">window</span>.localstorage.getItem(<span class="hljs-string">'user'</span>)
    <span class="hljs-keyword">if</span>(data){
        <span class="hljs-keyword">const</span> user = <span class="hljs-built_in">JSON</span>.parse(data)
        <span class="hljs-keyword">if</span>(user.hasOwnProperty(<span class="hljs-string">'name'</span>)){
            <span class="hljs-keyword">return</span> user.name
        } 
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">default</span>
}
</code></pre>
<p>Can become</p>
<pre><code><span class="hljs-keyword">const</span> getMaybeUserName = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span>
    localStorageGet(<span class="hljs-string">'user'</span>)
    .map(<span class="hljs-built_in">JSON</span>.parse)
    .chain(safeProp(<span class="hljs-string">'name'</span>))
</code></pre>
<h3>Why is this better?</h3>
<p>There are some downsides to the Maybe version: I’ve had to invent some custom types and functions to support it, and readers of the code may have trouble figuring out what it does compared to low level vanilla javascript. In some situations, an <code>if</code> may be the best choice.</p>
<p>However, the <code>if</code> version either hides the uncertainty from the caller by returning a default, or propagates it by returning a null.
By returning a <em>Maybe</em>, <code>getMaybeUserName</code> is honest about the uncertainty and gives the caller control. We can carry on composing operations into our Maybe, or extract a value when we choose:</p>
<pre><code><span class="hljs-comment">// render a greeting to the user, </span>
<span class="hljs-comment">// using 'Guest' as the default username</span>

<span class="hljs-keyword">const</span> maybeUserName = getMaybeUserName()
renderGreeting(maybeUserName.getOrElse(<span class="hljs-string">'Guest'</span>))

<span class="hljs-comment">// If we have a username</span>
<span class="hljs-comment">// use it to lookup a user</span>
<span class="hljs-comment">// then if the user has a 'favs' list , render it</span>

<span class="hljs-keyword">const</span> maybeRenderFavs = maybeUserName
.<span class="hljs-built_in">map</span>(lookupUser) <span class="hljs-comment">//=&gt; Maybe(Promise({favs: [Fav]}))</span>
.getOrElse(Promise.resolve({})) <span class="hljs-comment">//=&gt; Promise({})</span>
.then(u =&gt; 
    safeProp(<span class="hljs-string">'favs'</span>)(u)
    .<span class="hljs-built_in">map</span>(renderFavourites)
)
.<span class="hljs-built_in">catch</span>(handleErrors)
</code></pre>
<p>NB: While I’ve used <code>Promise</code>s in the example above, there is another abstraction for asychronous values called <a href="http://docs.folktalejs.org/en/latest/api/data/task/Task.html">Task</a> (also known as <a href="https://github.com/ramda/ramda-fantasy/blob/master/docs/Future.md">Future</a> in some libraries) which can have some <a href="https://glebbahmutov.com/blog/difference-between-promise-and-task/">advantages over Promises</a>.</p>
<p>The <code>map</code> and <code>chain</code> interfaces give you <em>composability</em> and  <em>caller control</em>, not just with uncertain values or asynchronous values, but for data types with other semantics as well - see <a href="https://github.com/ramda/ramda-fantasy/">Ramda Fantasy</a> for a sample.</p>
<p>There are also other generic interfaces that can be implemented across various different datatypes - <a href="https://github.com/fantasyland/fantasy-land">Fantasy Land</a> is a specification that defines a selection of the most useful of these.</p>
<p>For further explanation, I highly recommend <a href="http://twitter.com/drboolean">@drboolean</a>’s <a href="https://egghead.io/courses/professor-frisby-introduces-composable-functional-javascript">Professor Frisby Videos</a> and <a href="https://drboolean.gitbooks.io/mostly-adequate-guide/">online book, Mostly Adequate Guide to Functional Programming</a></p>
</div><em style="display:block;margin-bottom:3.5rem;" data-reactid="8"><!-- react-text: 9 -->Posted <!-- /react-text --><!-- react-text: 10 -->January 23, 2017<!-- /react-text --></em><hr style="margin-bottom:3.5rem;" data-reactid="11"/><noscript data-reactid="12"></noscript><p style="margin-bottom:4.375rem;" data-reactid="13"><img src="data:image/jpeg;base64,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" alt="author Keith Alexander" style="float:left;margin-right:0.4375rem;margin-bottom:0;width:3.5rem;height:3.5rem;" data-reactid="14"/><!-- react-text: 15 -->Written by <!-- /react-text --><a href="https://twitter.com/keithalexander" data-reactid="16">Keith Alexander</a><!-- react-text: 17 -->. Interests include functional programming, web tech, event sourcing and linked data.<!-- /react-text --></p></div><span style="display:block;clear:both;" data-reactid="18"> </span></div></div><script src="/bundle.js?t=1485348291183"></script></body></html>